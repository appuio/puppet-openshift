<%-
require 'shellwords'

def ansiblize(value)
  if value.is_a?(FalseClass)
    return 'False'
  end

  if value.is_a?(TrueClass)
    return 'True'
  end

  return value.to_json
end
-%>
# THIS FILE IS MANAGED BY PUPPET MODULE <%= @module_name %>
<% @host_groups.sort.each do |group, values| -%>

<%   if not (children = values.fetch('children', {})).empty? -%>
[<%= group %>:children]
<%     children.sort.each do |i| -%>
<%= i %>
<%     end -%>
<%   end -%>

<%   if not (vars = values.fetch('vars', {})).empty? -%>
[<%= group %>:vars]
<%     vars.sort.each do |key, value| -%>
<%= key %>=<%= ansiblize(value) %>
<%     end -%>
<%   end -%>

<%   if not (hosts = values.fetch('hosts', {})).empty? -%>
[<%= group %>]
<%     hosts.sort.each do |i, hostvars| -%>
<%= i %> <%= hostvars.sort.map { |key, value| "#{key}=#{Shellwords.escape(ansiblize(value))}" }.join(' ') %>
<%     end -%>
<%   end -%>
<% end -%>
